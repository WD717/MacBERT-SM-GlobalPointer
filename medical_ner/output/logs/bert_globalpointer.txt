模型名称: bert_globalpointer
设备: cpu

设备: cpu


1. 数据准备
数据已划分完成

2. 开始训练模型
2026-01-13 08:32:28.563624: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-13 08:32:33.149337: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.

Epoch 1/10
--------------------------------------------------
训练: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████| 400/400 [36:50<00:00,  5.53s/it] 
训练损失: 0.0167
评估:   0%|                                                                                                                    | 0/25 [00:02<?, ?it/s]
Traceback (most recent call last):
  File "C:\Users\Lenovo\Desktop\AAA研究生存档\课程学习\自然语言处理\code\medical_ner\main.py", line 106, in <module>
    main()
  File "C:\Users\Lenovo\Desktop\AAA研究生存档\课程学习\自然语言处理\code\medical_ner\main.py", line 78, in main
  File "C:\Users\Lenovo\Desktop\AAA研究生存档\课程学习\自然语言处理\code\medical_ner\train.py", line 457, in main
    trainer.train(train_data, val_data)
  File "C:\Users\Lenovo\Desktop\AAA研究生存档\课程学习\自然语言处理\code\medical_ner\train.py", line 325, in train
    metrics = self.evaluate(val_dataloader)
  File "C:\Users\Lenovo\Desktop\AAA研究生存档\课程学习\自然语言处理\code\medical_ner\train.py", line 259, in evaluate
    pred_entities = decode_globalpointer_logits(
  File "C:\Users\Lenovo\Desktop\AAA研究生存档\课程学习\自然语言处理\code\medical_ner\utils\metrics.py", line 240, in decode_globalpointer_logits       
    probs = torch.sigmoid(logits)
NameError: name 'torch' is not defined
PS E:\AAA研究生存档\课程学习\自然语言处理\code> python C:\Users\Lenovo\Desktop\AAA研究生存档\课程学习\自然语言处理\code\medical_ner\main.py --model bert_globalpointer --train

中文医疗实体识别模型
模型名称: bert_globalpointer
设备: cpu

1. 数据准备
数据已划分完成

2. 开始训练模型
2026-01-13 14:45:50.913300: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-13 14:45:55.542786: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.

Epoch 1/10
--------------------------------------------------
训练: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████| 400/400 [36:55<00:00,  5.54s/it] 
训练损失: 0.0174
评估: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████| 25/25 [15:49<00:00, 37.99s/it]
实体识别评估指标
==================================================
中药功效:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 110
------------------------------
人群:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 154
------------------------------
疾病:
  精确率: 0.2940
  召回率: 0.9281
  F1值: 0.4465
  TP: 1909, FP: 4584, FN: 148
------------------------------
疾病分组:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 606
------------------------------
症状:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 26
------------------------------
药品:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 1
------------------------------
药品分组:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 145
------------------------------
药物剂型:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 325
------------------------------
药物性味:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 298
------------------------------
药物成分:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 63
------------------------------
证候:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 102
------------------------------
食物:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 1
------------------------------
食物分组:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 21
------------------------------
微平均:
  精确率: 0.2940
  召回率: 0.4884
  F1值: 0.3670
------------------------------
宏平均:
  精确率: 0.0226
  召回率: 0.0714
  F1值: 0.0343
==================================================
保存最佳模型到 C:\Users\Lenovo\Desktop\AAA研究生存档\课程学习\自然语言处理\code\medical_ner\output\models\bert_globalpointer_best_model.pt

Epoch 2/10
--------------------------------------------------
训练: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████| 400/400 [36:40<00:00,  5.50s/it] 
训练损失: 0.0006
评估: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████| 25/25 [15:45<00:00, 37.81s/it] 
实体识别评估指标
==================================================
中药功效:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 110
------------------------------
人群:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 154
------------------------------
疾病:
  精确率: 0.7604
  召回率: 0.9796
  F1值: 0.8562
  TP: 2015, FP: 635, FN: 42
------------------------------
疾病分组:
  精确率: 0.2190
  召回率: 0.6848
  F1值: 0.3319
  TP: 415, FP: 1480, FN: 191
------------------------------
症状:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 26
------------------------------
药品:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 1
------------------------------
药品分组:
  精确率: 1.0000
  召回率: 0.0138
  F1值: 0.0272
  TP: 2, FP: 0, FN: 143
------------------------------
药物剂型:
  精确率: 0.3510
  召回率: 0.6708
  F1值: 0.4609
  TP: 218, FP: 403, FN: 107
------------------------------
药物性味:
  精确率: 0.7233
  召回率: 0.8423
  F1值: 0.7783
  TP: 251, FP: 96, FN: 47
------------------------------
药物成分:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 63
------------------------------
证候:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 102
------------------------------
食物:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 1
------------------------------
食物分组:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 21
------------------------------
微平均:
  精确率: 0.5260
  召回率: 0.7421
  F1值: 0.6157
------------------------------
宏平均:
  精确率: 0.2349
  召回率: 0.2455
  F1值: 0.1888
==================================================
保存最佳模型到 C:\Users\Lenovo\Desktop\AAA研究生存档\课程学习\自然语言处理\code\medical_ner\output\models\bert_globalpointer_best_model.pt

Epoch 3/10
--------------------------------------------------
训练: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████| 400/400 [36:42<00:00,  5.51s/it] 
训练损失: 0.0002
评估: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████| 25/25 [16:31<00:00, 39.65s/it] 
实体识别评估指标
==================================================
中药功效:
  精确率: 0.4388
  召回率: 0.7818
  F1值: 0.5621
  TP: 86, FP: 110, FN: 24
------------------------------
人群:
  精确率: 0.3169
  召回率: 0.7922
  F1值: 0.4527
  TP: 122, FP: 263, FN: 32
------------------------------
疾病:
  精确率: 0.8543
  召回率: 0.9859
  F1值: 0.9154
  TP: 2028, FP: 346, FN: 29
------------------------------
疾病分组:
  精确率: 0.4065
  召回率: 0.9472
  F1值: 0.5689
  TP: 574, FP: 838, FN: 32
------------------------------
症状:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 26
------------------------------
药品:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 1
------------------------------
药品分组:
  精确率: 0.5442
  召回率: 0.8483
  F1值: 0.6631
  TP: 123, FP: 103, FN: 22
------------------------------
药物剂型:
  精确率: 0.4433
  召回率: 0.8892
  F1值: 0.5916
  TP: 289, FP: 363, FN: 36
------------------------------
药物性味:
  精确率: 0.5983
  召回率: 0.9396
  F1值: 0.7311
  TP: 280, FP: 188, FN: 18
------------------------------
药物成分:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 63
------------------------------
证候:
  精确率: 0.2727
  召回率: 0.8529
  F1值: 0.4133
  TP: 87, FP: 232, FN: 15
------------------------------
食物:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 1
------------------------------
食物分组:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 21
------------------------------
微平均:
  精确率: 0.5950
  召回率: 0.9181
  F1值: 0.7221
------------------------------
宏平均:
  精确率: 0.2981
  召回率: 0.5413
  F1值: 0.3768
==================================================
保存最佳模型到 C:\Users\Lenovo\Desktop\AAA研究生存档\课程学习\自然语言处理\code\medical_ner\output\models\bert_globalpointer_best_model.pt

Epoch 4/10
--------------------------------------------------
训练: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████| 400/400 [38:20<00:00,  5.75s/it] 
训练损失: 0.0001
评估: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████| 25/25 [17:47<00:00, 42.72s/it]
实体识别评估指标
==================================================
中药功效:
  精确率: 0.4053
  召回率: 0.9727
  F1值: 0.5722
  TP: 107, FP: 157, FN: 3
------------------------------
人群:
  精确率: 0.3288
  召回率: 0.9351
  F1值: 0.4865
  TP: 144, FP: 294, FN: 10
------------------------------
疾病:
  精确率: 0.8780
  召回率: 0.9898
  F1值: 0.9305
  TP: 2036, FP: 283, FN: 21
------------------------------
疾病分组:
  精确率: 0.5052
  召回率: 0.9538
  F1值: 0.6606
  TP: 578, FP: 566, FN: 28
------------------------------
症状:
  精确率: 1.0000
  召回率: 0.0385
  F1值: 0.0741
  TP: 1, FP: 0, FN: 25
------------------------------
药品:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 1
------------------------------
药品分组:
  精确率: 0.4946
  召回率: 0.9517
  F1值: 0.6509
  TP: 138, FP: 141, FN: 7
------------------------------
药物剂型:
  精确率: 0.5009
  召回率: 0.9046
  F1值: 0.6447
  TP: 294, FP: 293, FN: 31
------------------------------
药物性味:
  精确率: 0.7553
  召回率: 0.9530
  F1值: 0.8427
  TP: 284, FP: 92, FN: 14
------------------------------
药物成分:
  精确率: 0.3905
  召回率: 0.6508
  F1值: 0.4881
  TP: 41, FP: 64, FN: 22
------------------------------
证候:
  精确率: 0.3014
  召回率: 0.8627
  F1值: 0.4467
  TP: 88, FP: 204, FN: 14
------------------------------
食物:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 1
------------------------------
食物分组:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 21
------------------------------
微平均:
  精确率: 0.6393
  召回率: 0.9493
  F1值: 0.7641
------------------------------
宏平均:
  精确率: 0.4277
  召回率: 0.6317
  F1值: 0.4459
==================================================
保存最佳模型到 C:\Users\Lenovo\Desktop\AAA研究生存档\课程学习\自然语言处理\code\medical_ner\output\models\bert_globalpointer_best_model.pt

Epoch 5/10
--------------------------------------------------
训练: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████| 400/400 [35:02<00:00,  5.26s/it] 
训练损失: 0.0001
评估: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████| 25/25 [17:01<00:00, 40.87s/it] 
实体识别评估指标
==================================================
中药功效:
  精确率: 0.4170
  召回率: 0.9818
  F1值: 0.5854
  TP: 108, FP: 151, FN: 2
------------------------------
人群:
  精确率: 0.3766
  召回率: 0.9416
  F1值: 0.5380
  TP: 145, FP: 240, FN: 9
------------------------------
疾病:
  精确率: 0.8876
  召回率: 0.9903
  F1值: 0.9361
  TP: 2037, FP: 258, FN: 20
------------------------------
疾病分组:
  精确率: 0.5022
  召回率: 0.9571
  F1值: 0.6587
  TP: 580, FP: 575, FN: 26
------------------------------
症状:
  精确率: 0.7273
  召回率: 0.6154
  F1值: 0.6667
  TP: 16, FP: 6, FN: 10
------------------------------
药品:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 1
------------------------------
药品分组:
  精确率: 0.6026
  召回率: 0.9517
  F1值: 0.7380
  TP: 138, FP: 91, FN: 7
------------------------------
药物剂型:
  精确率: 0.6020
  召回率: 0.9077
  F1值: 0.7239
  TP: 295, FP: 195, FN: 30
------------------------------
药物性味:
  精确率: 0.7646
  召回率: 0.9698
  F1值: 0.8550
  TP: 289, FP: 89, FN: 9
------------------------------
药物成分:
  精确率: 0.2924
  召回率: 0.7937
  F1值: 0.4274
  TP: 50, FP: 121, FN: 13
------------------------------
证候:
  精确率: 0.4611
  召回率: 0.8725
  F1值: 0.6034
  TP: 89, FP: 104, FN: 13
------------------------------
食物:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 1
------------------------------
食物分组:
  精确率: 0.3158
  召回率: 0.2857
  F1值: 0.3000
  TP: 6, FP: 13, FN: 15
------------------------------
微平均:
  精确率: 0.6707
  召回率: 0.9601
  F1值: 0.7897
------------------------------
宏平均:
  精确率: 0.4576
  召回率: 0.7129
  F1值: 0.5410
==================================================
保存最佳模型到 C:\Users\Lenovo\Desktop\AAA研究生存档\课程学习\自然语言处理\code\medical_ner\output\models\bert_globalpointer_best_model.pt

Epoch 6/10
--------------------------------------------------
训练: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████| 400/400 [42:54<00:00,  6.44s/it] 
训练损失: 0.0001
评估: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████| 25/25 [16:16<00:00, 39.06s/it]
实体识别评估指标
==================================================
中药功效:
  精确率: 0.4553
  召回率: 0.9727
  F1值: 0.6203
  TP: 107, FP: 128, FN: 3
------------------------------
人群:
  精确率: 0.3539
  召回率: 0.9675
  F1值: 0.5183
  TP: 149, FP: 272, FN: 5
------------------------------
疾病:
  精确率: 0.8756
  召回率: 0.9922
  F1值: 0.9303
  TP: 2041, FP: 290, FN: 16
------------------------------
疾病分组:
  精确率: 0.5266
  召回率: 0.9620
  F1值: 0.6807
  TP: 583, FP: 524, FN: 23
------------------------------
症状:
  精确率: 0.7600
  召回率: 0.7308
  F1值: 0.7451
  TP: 19, FP: 6, FN: 7
------------------------------
药品:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 1
------------------------------
药品分组:
  精确率: 0.6106
  召回率: 0.9517
  F1值: 0.7439
  TP: 138, FP: 88, FN: 7
------------------------------
药物剂型:
  精确率: 0.5698
  召回率: 0.9169
  F1值: 0.7028
  TP: 298, FP: 225, FN: 27
------------------------------
药物性味:
  精确率: 0.7293
  召回率: 0.9765
  F1值: 0.8350
  TP: 291, FP: 108, FN: 7
------------------------------
药物成分:
  精确率: 0.2742
  召回率: 0.8095
  F1值: 0.4096
  TP: 51, FP: 135, FN: 12
------------------------------
证候:
  精确率: 0.5833
食物:
  精确率: 0.0000
  召回率: 0.0000
  F1值: 0.0000
  TP: 0, FP: 0, FN: 1
------------------------------
食物分组:
  精确率: 0.1600
  召回率: 0.3810
  F1值: 0.2254
  TP: 8, FP: 42, FN: 13
------------------------------
微平均:
  精确率: 0.6673
  召回率: 0.9660
  F1值: 0.7893
------------------------------
宏平均:
  精确率: 0.4537
  召回率: 0.7349
  F1值: 0.5474
==================================================